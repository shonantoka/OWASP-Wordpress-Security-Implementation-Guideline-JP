# 3.インフラストラクチャセキュリティ
WordPressコアを堅牢化する前に、インスタンスがインストールされるサービスの堅牢化を検討する必要があります。実装者の制御下にインフラストラクチャがない場合があります。インフラストラクチャ側で修正されるべきことを軽減するためにWordPress側で堅牢化することができることもあります。一方で、常により強固なインフラストラクチャを構築する必要があります。
実装者は、インフラストラクチャ管理者に連絡して、そのインフラストラクチャ上にインストールされるアプリケーション（この場合はWordPress）をさらに保護するために、具体的なインフラストラクチャの堅牢化を求めることができます。
インフラストラクチャの堅牢化の基礎は、OSを堅牢化することです。これはOSに大きく依存した幅広いテーマであり、特権、アクセス制御、認証、ロギングに関する主な検討事項があります。これは、本ガイドラインの範囲外のトピックであり、経験豊富なシステム管理者が考慮しなければならないものです。
WordPressは多数のプラットフォームにインストールできますが、本ガイドラインでは最も一般的なコンポーネントであるApacheとMySQLに焦点をあてています。一般的なルールは、サポートされているすべてのインフラストラクチャコンポネントに適用されます。
設計のベストプラクティスに従えば、WordPressインスタンスの層は分離する必要がある一方で、WordPressのプレゼンテーション層とアプリケーション層は結合されています。したがって、データベースを分離することが唯一採り得る方法です。小規模なアプリケーションの場合には、一般的な方法ではありませんが、大規模なサイトの場合、パフォーマンスの観点だけでなく、セキュリティの観点からもデータベースの分離は必須です。
一般的なセキュリティの場合と同じように、これはインフラストラクチャを堅牢化するために実行すべきもののリストにすぎず、それをすべて実施することを意図したものではありません。

## 3.1.Apache堅牢化
* 定期的に更新する
* ディレクトリリスティングを無効にする
* SSL証明書を生成・使用し、サーバとの通信を保護する
* 不要なモジュールを無効にする
  * 無効にするモジュールの候補は、userdir、suexec、cgi / cgid、include、autoindexです
* 別のユーザとグループとしてデーモンを実行する
* AllowとDenyを使用して、ディレクトリへのアクセスを制限する
* mod_securityモジュールを使用してApacheを保護する
* シンボリックリンクに従わないようにする
* サーバーサイドインクルードとCGI実行を無効にする
* リクエストサイズを制限する
* DoS攻撃を防ぐために、TimeOut、MaxClients、KeepAliveTimeout、LimitRequestFields、LimitRequestFieldSizeなどのその他の設定を構成する
* 適切なログの取得を有効にする
* サーババナーを変更する

## 3.2.PHP堅牢化

* 定期的に更新する
* PHPをCGIバイナリとしてインストールしない
* 不要なPHPモジュールを無効にする
* 未使用の潜在的に危険なPHP関数を無効にする（例：exec、passthru、shell_exec、systemなど）
* 内部的にエラーを記録する
* クライアント側で冗長なエラー報告を無効にする
* リモートコードの実行をオフにする（必要がない場合、WordPressコアにはこの機能は必要ありません）
* マジッククオートを無効にする
* ファイルシステムへのPHPアクセスを制限する
* DoSから保護する
  * POSTサイズを制御する
  * スクリプト実行時間を制限する
  * メモリ使用量を制限する
* [Suhoshinセキュリティ拡張機能](http://www.suhosin.org/stories/index.html)の実装を検討する
* 使用中のPHPのバージョンを隠す
* .php拡張子を隠す

# 3.3.MySQL堅牢化
MySQLの堅牢化に関する[OWASPプロジェクト](https://www.owasp.org/index.php/OWASP_Backend_Security_Project_MySQL_Hardening)があります。 主要なアクション項目は以下のとおりです。

* 定期的に更新する
* リモートアクセスを無効にするか制限する
* ファイルシステムのアクセス制限とACLを利用する
* chroot-jailを設計する
* ネットワークトラフィックを暗号化する（これは、データベースレイヤが物理的にアプリケーションレイヤから分離されている場合に必要です）
* ファイルシステムレベルでデータベースを暗号化する
  * ディスク暗号化がOS層にある場合は冗長化する
  * しかし、dmcryptを使うことで暗号化のための層を生成できる
* バックアップを暗号化する
* 構成
  * 接続性：最大同時接続数と関連する設定
  * ロギング
  * アクセス制御と特権管理
  * ルートパスワードを設定する
  * rootアカウントの名前を変更する
  * 未使用のユーザとデータベースを削除する
  * インストール履歴を削除する
PHPセキュリティーチェッカーは[こちら](https://github.com/sektioneins/pcc)から入手できます。 これは、PHPの構成を分析し、重大度に基づいて結果をランク付けするために設計されたPHPファイルです。

# 3.4.リモートアクセス
* FTPを使用しない（可能であればsFTPを使用する）
* SSHアクセスが利用可能な場合は、ファイル転送にscpまたはWinSCPを使用する
* WordPress管理インタフェースにアクセスするため、VPNまたはSSHトンネルの使用を検討する
